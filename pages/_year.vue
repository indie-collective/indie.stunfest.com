<template>
  <div>
    <section :class="`header-${currentYear}`" class="hero">
      <div class="container has-text-centered">
        <h1><img :src="logoPath" alt="Stunfest Indie Game logo" /></h1>
      </div>
    </section>
    <section :class="`header-${currentYear}`" class="hero sticky">
      <div class="hero-foot">
        <nav class="control is-hidden-tablet">
          <div class="select is-medium is-fullwidth">
            <select @change="onSelectChange()" v-model="currentTab">
              <option v-for="tab in currentYearTabs" :key="tab" :value="tab">{{
                getDisplayName(tab)
              }}</option>
              <optgroup label="Années">
                <option
                  v-for="year in filteredYears"
                  :key="year"
                  :value="year"
                  >{{ year }}</option
                >
              </optgroup>
            </select>
          </div>
        </nav>
        <nav class="tabs is-medium is-fullwidth is-boxed is-hidden-mobile">
          <div class="container">
            <ul>
              <li
                v-for="tab in currentYearTabs"
                :key="tab"
                :class="
                  `header-tab-${currentYear}${
                    filter === tab ? ' is-active' : ''
                  }`
                "
                @click="filter = tab"
              >
                <a
                  :class="{
                    'has-text-weight-bold': filter === tab
                  }"
                >
                  {{ getDisplayName(tab) }}
                </a>
              </li>
              <li class="years-dropdown">
                <a class="dropdown is-hoverable">
                  <div class="dropdown-trigger">
                    <button
                      class="button is-text"
                      aria-haspopup="true"
                      aria-controls="dropdown-menu"
                    >
                      <span>{{ currentYear }}</span>
                      <span class="icon is-small">
                        <i class="fas fa-angle-down" aria-hidden="true" />
                      </span>
                    </button>
                  </div>
                  <div id="dropdown-menu" class="dropdown-menu" role="menu">
                    <div class="dropdown-content">
                      <nuxt-link
                        v-for="year in filteredYears"
                        :key="year"
                        :to="`/${year}`"
                        class="dropdown-item"
                      >
                        {{ year }}
                      </nuxt-link>
                    </div>
                  </div>
                </a>
              </li>
            </ul>
          </div>
        </nav>
      </div>
    </section>

    <section v-if="filter === 'all' && sortedAwards.length" class="section">
      <div class="columns is-tablet is-multiline is-centered">
        <div
          v-for="game in sortedAwards"
          :key="game.title"
          v-if="game.title"
          :class="
            game.award + '-award' + (game.award === 'indie' ? ' is-half' : '')
          "
          class="award-container column is-half-tablet is-one-quarter-widescreen"
        >
          <p
            :class="`award-${currentYear}`"
            class="award title is-size-3 is-uppercase has-text-centered"
          >
            {{ game.award }}
          </p>
          <card
            v-if="isGameVisible(game)"
            :card="game"
            :vote-link="game.voteLink"
            class="tile is-vertical"
          >
            {{ game.summary }}
          </card>
        </div>
      </div>
    </section>

    <section
      v-for="section in filteredSections"
      :key="section.displayName"
      class="section"
    >
      <p :class="`title-${currentYear}`" class="title is-size-1 is-uppercase">
        {{ section.displayName }}
      </p>
      <div class="columns is-tablet is-multiline is-centered">
        <div
          v-for="game in section.games"
          :key="game.title"
          class="column is-half-tablet is-one-third-desktop is-one-quarter-widescreen"
        >
          <card
            v-if="isGameVisible(game)"
            :card="game"
            :vote-link="game.voteLink"
          >
            {{ game.summary }}
          </card>
          <card
            v-if="!isGameVisible(game)"
            :card="{
              title: ''
            }"
            class="disabled"
          >
          </card>
        </div>
      </div>
    </section>

    <section :class="`empty-section-${currentYear}`" class="empty-section" v-if="filteredSections.length === 0">
      <p>Les jeux seront annoncés<br />prochainement !</p>
    </section>
  </div>
</template>
<style lang="scss" src="~/pages/year.scss"></style>
<script src="~/pages/year.js"></script>
